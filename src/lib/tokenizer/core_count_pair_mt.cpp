// core function for count pair using non-singleton memory pool